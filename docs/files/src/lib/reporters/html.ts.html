
  <!DOCTYPE html>
  <html>
    <head>
      <title>html.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">src/lib/reporters/html.ts</td><td class="">100.00%</td><td class="">90%</td><td class="">181</td><td class="">181</td><td class="">0</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">import React from &quot;react&quot;;
import react from &quot;react-dom/server&quot;;
import path from &quot;path&quot;;
import fs from &quot;fs&quot;;
import { promisify } from &quot;util&quot;;
import { CoverageData } from &quot;../getCoverage&quot;;
import SummaryPage from &quot;../../components/SummaryPage&quot;;
import DetailPage from &quot;../../components/DetailPage&quot;;

const writeFile = promisify(fs.writeFile);
const readFile = promisify(fs.readFile);
const mkdir = promisify(fs.mkdir);

export type Options = {
  outputDir: string;
  threshold: number;
};

const checkOrWriteFolder = (outputDir: string): string =&gt; {
  if (!fs.existsSync(outputDir)) {
    fs.mkdirSync(outputDir);
  }

  return outputDir;
};

const includeAsset = (filename: string): string =&gt; {
  const extension = path.extname(filename);
  if (extension === &quot;.js&quot;) {
    return `&lt;script src=&quot;${filename}&quot; type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;`;
  }

  if (extension === &quot;.css&quot;) {
    return `&lt;link href=&quot;${filename}&quot; type=&quot;text/css&quot; rel=&quot;stylesheet&quot;&gt;`;
  }

  console.warn(`includeAsset: couldn&#x27;t recognise the extension ${extension}`);

  return &quot;&quot;;
};

const includeAssets = (assets: readonly string[]): string =&gt;
  assets.map(includeAsset).join(&quot;\n&quot;);

const wrapHTMLContent = (
  Component: React.ElementType,
  props?: Record&lt;string, any&gt;,
  options:
    | {
        title?: string;
        assets?: string;
      }
    | undefined = {}
): string =&gt; {
  const content = react.renderToStaticMarkup(
    React.createElement(Component, props)
  );

  return `
  &lt;!DOCTYPE html&gt;
  &lt;html&gt;
    &lt;head&gt;
      &lt;title&gt;${options.title || &quot;TypeScript coverage report&quot;}&lt;/title&gt;
      ${includeAsset(
        &quot;https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css&quot;
      )}
      ${options.assets || &quot;&quot;}
    &lt;/head&gt;
    &lt;body&gt;
    ${content}
    &lt;p class=&quot;footer-text&quot;&gt;TypeScript Coverage Report generated by &lt;a href=&quot;https://github.com/plantain-00/type-coverage&quot;&gt;type-coverage&lt;/a&gt; and &lt;a href=&quot;https://github.com/alexcanessa/typescript-coverage-report&quot;&gt;typescript-coverage-report&lt;/a&gt; at ${new Date().toUTCString()}&lt;/p&gt;
    &lt;/body&gt;
  &lt;/html&gt;
  `;
};

// NOTE: This generate function has side effect of creating the index.html
export const generate = async (
  data: CoverageData,
  options?: Options
): Promise&lt;void&gt; =&gt; {
  // NOTE: Create index file
  const fileContent = wrapHTMLContent(
    SummaryPage,
    {
      fileCounts: data.fileCounts,
      percentage: data.percentage,
      total: data.total,
      covered: data.covered,
      uncovered: data.uncovered,
      threshold: options.threshold
    },
    {
      assets: includeAssets([
        &quot;./assets/source-file.css&quot;,
        &quot;https://cdn.jsdelivr.net/npm/sorttable@1.0.2/sorttable.min.js&quot;
      ])
    }
  );

  await writeFile(
    path.join(checkOrWriteFolder(options.outputDir), &quot;index.html&quot;),
    fileContent
  );

  // NOTE: Create the other files
  for (const [filename, { totalCount, correctCount }] of Array.from(
    data.fileCounts
  )) {
    await mkdir(path.join(options.outputDir, &quot;files&quot;, path.dirname(filename)), {
      recursive: true
    });

    const annotations = data.anys.filter(({ file }) =&gt; file === filename);
    const assetsFolder = path.relative(filename, &quot;assets&quot;);
    const sourceCode = await readFile(filename, &quot;utf-8&quot;);
    const detailContent = wrapHTMLContent(
      DetailPage,
      {
        filename,
        sourceCode,
        totalCount,
        correctCount,
        annotations,
        threshold: options.threshold
      },
      {
        title: path.basename(filename),
        assets: includeAssets([
          &quot;https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js&quot;,
          &quot;https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js&quot;,
          &quot;https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css&quot;,
          path.join(assetsFolder, &quot;source-file.js&quot;),
          path.join(assetsFolder, &quot;source-file.css&quot;)
        ])
      }
    );

    await writeFile(
      path.join(options.outputDir, &quot;files&quot;, `${filename}.html`),
      detailContent
    );
  }

  const generatedFile = path.resolve(
    path.join(options.outputDir, &quot;index.html&quot;)
  );

  console.log(`View generated HTML Report at ${generatedFile}`);
};
</textarea><pre id="annotations" style="display:none">[]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Mon, 12 Feb 2024 12:41:22 GMT</p>
    </body>
  </html>
  